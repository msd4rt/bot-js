/**
 * Ligmar Bot - Модульная версия
 * Главный файл-загрузчик модулей
 */

(async function() {
    'use strict';
    
    // Временный лог до загрузки конфига
    console.log('🤖 Ligmar Bot - Запуск модульной версии...');
    
    // Базовый URL для загрузки модулей
    const BASE_URL = 'https://raw.githubusercontent.com/msd4rt/bot-js/main';
    
    // Список модулей для загрузки
    const MODULES = [
        'modules/Adsdsa.js',
        'modules/Etewuf.js', 
        'modules/Pdirtyhb.js',
        'modules/bmcvfujfu.js',
        'modules/Pdirhn.js',
        'modules/Idufdnm.js',
        'modules/Irubj.js',
        'modules/Dlfkf.js'
    ];
    
/**
 * Загрузка и выполнение модуля, закодированного в Base64 (UTF-8)
 * @param {string} moduleUrl - URL модуля (который теперь будет указывать на .base64 файл)
 */
async function loadModule(moduleUrl) {
    try {
        // Убедитесь, что BASE_URL указывает на корневой путь вашего raw-репозитория на GitHub,
        // и moduleUrl уже включает расширение .base64, например: 'modules/config.js.base64'
        const fullUrl = `${BASE_URL}/${moduleUrl}?nocache=${Date.now()}`;
        console.log('Загрузка Base64 модуля:', fullUrl);

        const response = await fetch(fullUrl);
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const encodedContent = await response.text(); // Это ваша Base64 строка
        
        // --- Шаг 1: Декодируем Base64 в "бинарную строку" (ISO-8859-1) ---
        const binaryString = atob(encodedContent);
        
        // --- Шаг 2: Преобразуем бинарную строку в массив байтов (Uint8Array) ---
        const len = binaryString.length;
        const bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binaryString.charCodeAt(i);
        }
        
        // --- Шаг 3: Декодируем массив байтов в UTF-8 строку ---
        const decoder = new TextDecoder('utf-8');
        const decodedCode = decoder.decode(bytes);
        
        // --- Шаг 4: Выполняем полученный JavaScript код ---
        eval(decodedCode);
        
        console.log(`✅ Модуль Base64 загружен и выполнен: ${moduleUrl}`);
    } catch (error) {
        console.error(`❌ Ошибка загрузки или декодирования Base64 модуля ${moduleUrl}:`, error);
        throw error;
    }
}

    
    /**
     * Последовательная загрузка всех модулей
     */
    async function loadAllModules() {
        console.log('📦 Загрузка модулей...');
        
        for (const module of MODULES) {
            await loadModule(module);
            // Небольшая задержка между загрузками
            await new Promise(resolve => setTimeout(resolve, 100));
        }
        
        console.log('✅ Все модули загружены успешно!');
    }
    
    /**
     * Проверка загрузки всех модулей
     */
    function verifyModules() {
        const requiredModules = [
            'BotConfig',
            'BotSecurity',
            'BotUtils', 
            'BotUI',
            'BotNavigation',
            'BotCombat',
            'BotInventory',
            'BotStatistics',
            'BotGameLogic'
        ];
        
        const missingModules = requiredModules.filter(module => !window[module]);
        
        if (missingModules.length > 0) {
            console.error('❌ Отсутствуют модули:', missingModules);
            return false;
        }
        
        console.log('✅ Все модули проверены и готовы к работе');
        return true;
    }
    
    /**
     * Инициализация бота
     */
    async function initializeBot() {
        console.log('🚀 Инициализация бота...');
        
        try {
            // Инициализируем систему позиционирования кнопок
            if (window.BotUI && window.BotUI.initializeButtonPositioning) {
                window.BotUI.initializeButtonPositioning();
            }
            
            // Создание кнопки боссов (доступна до авторизации)
            if (window.BotGameLogic && window.BotGameLogic.createBossButtons) {
                await window.BotGameLogic.createBossButtons();
            }
            
            // Создание кнопки авторизации
            await window.BotUI.createAuthButton();
            
            // Создание окна настроек
            await window.BotUI.createSettingsWindow();
            
            // Создание элементов статистики
            if (window.BotStatistics) {
                await window.BotStatistics.createStatisticsElement();
                window.BotStatistics.initializeStatistics();
            }
            
            console.log('✅ Бот успешно инициализирован!');
            console.log('🎮 Используйте кнопку 💎 для авторизации');
            
        } catch (error) {
            console.error('❌ Ошибка инициализации бота:', error);
        }
    }
    
    // Основной процесс запуска
    try {
        await loadAllModules();
        
        if (verifyModules()) {
            await initializeBot();
        } else {
            throw new Error('Не удалось загрузить все необходимые модули');
        }
        
    } catch (error) {
        console.error('💥 Критическая ошибка запуска бота:', error);
        alert('Ошибка запуска бота. Проверьте консоль для деталей.');
    }
    
})();
